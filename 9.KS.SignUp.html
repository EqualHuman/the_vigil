<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Knotte Studios — Sign In</title>

  <style>
    :root{
      --bg:#0b0c10; --card:#12141b; --text:#f4f6ff; --muted:#b7bdd6;
      --line:rgba(255,255,255,.10);
      --accent:#7c5cff; --accent2:#20d3ff;
      --radius:18px;
      --shadow: 0 14px 40px rgba(0,0,0,.45);
      --sans: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono","Courier New", monospace;
    }
    *{box-sizing:border-box}
    body{
      margin:0; font-family:var(--sans);
      background: radial-gradient(1000px 600px at 20% -10%, rgba(124,92,255,.35), transparent 55%),
                  radial-gradient(900px 500px at 92% 10%, rgba(32,211,255,.25), transparent 55%),
                  var(--bg);
      color:var(--text);
    }
    .wrap{max-width:980px; margin:0 auto; padding:28px 18px 80px;}
    .top{
      display:flex; align-items:center; justify-content:space-between; gap:12px; flex-wrap:wrap;
      padding:14px 0;
    }
    .brand{display:flex; align-items:center; gap:12px; font-weight:900;}
    .logo{width:40px; height:40px; border-radius:12px; background:linear-gradient(135deg,var(--accent),var(--accent2));}
    a{color:inherit; text-decoration:none}
    .pill{border:1px solid var(--line); background:rgba(255,255,255,.03); padding:10px 12px; border-radius:999px; color:var(--muted); font-weight:750;}
    .panel{
      border:1px solid var(--line);
      background: rgba(255,255,255,.03);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 18px;
      display:grid;
      grid-template-columns: repeat(12,1fr);
      gap:16px;
      margin-top: 12px;
    }
    .box{
      grid-column: span 6;
      border:1px solid var(--line);
      background: rgba(0,0,0,.18);
      border-radius: 16px;
      padding: 16px;
    }
    h1{margin:0 0 8px; font-size:26px; letter-spacing:-.02em}
    p{margin:0 0 14px; color:var(--muted); line-height:1.55}
    label{display:block; margin:10px 0 6px; color:var(--muted); font-weight:700}
    input{
      width:100%;
      padding:12px 12px;
      border-radius: 12px;
      border:1px solid var(--line);
      background: rgba(255,255,255,.03);
      color: var(--text);
      outline:none;
      font-weight:700;
    }
    input::placeholder{color: rgba(183,189,214,.65)}
    .row{display:flex; gap:10px; flex-wrap:wrap; margin-top: 10px}
    button{
      border:none;
      background: linear-gradient(135deg, var(--accent), var(--accent2));
      color:#071018;
      font-weight:900;
      padding:12px 14px;
      border-radius: 12px;
      cursor:pointer;
      flex:1;
      min-width: 160px;
    }
    button.secondary{
      border:1px solid var(--line);
      background: rgba(255,255,255,.04);
      color: var(--text);
    }
    .meta{
      margin-top: 10px;
      font-family: var(--mono);
      font-size: .85rem;
      color: rgba(183,189,214,.85);
      border-top:1px solid var(--line);
      padding-top: 10px;
    }
    .warn{
      margin-top: 10px;
      border:1px solid rgba(255,77,109,.35);
      background: rgba(255,77,109,.08);
      color: rgba(255,240,245,.9);
      padding: 10px 12px;
      border-radius: 12px;
      display:none;
    }
    @media (max-width: 860px){
      .box{grid-column: span 12;}
    }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="top">
      <div class="brand">
        <div class="logo" aria-hidden="true"></div>
        <div>
          <div style="line-height:1.1;">Knotte Studios</div>
          <div style="color:var(--muted); font-weight:750; font-size:.88rem;">Account</div>
        </div>
      </div>
      <div style="display:flex; gap:10px; flex-wrap:wrap;">
        <a class="pill" href="9.KS.Home.html">Home</a>
        <a class="pill" href="9.KS.Dashboard.html">Dashboard</a>
        <a class="pill" href="9.KS.Editor.html">Editor</a>
      </div>
    </div>

    <div class="panel">
      <div class="box">
        <h1>Create your account</h1>
        <p>This prototype stores your account locally (no server). Later you’ll swap this for real authentication.</p>

        <label for="suEmail">Email</label>
        <input id="suEmail" type="email" placeholder="you@example.com" autocomplete="email" />

        <label for="suPass">Password</label>
        <input id="suPass" type="password" placeholder="••••••••" autocomplete="new-password" />

        <label for="suSlug">Your site URL slug</label>
        <input id="suSlug" type="text" placeholder="alex-and-jamie" />

        <div class="row">
          <button type="button" id="signUpBtn">Create account</button>
          <button type="button" class="secondary" id="pickTemplateBtn">Pick template</button>
        </div>

        <div class="warn" id="warn1"></div>

        <div class="meta">
          Selected template: <span id="selectedTpl">none</span>
        </div>
      </div>

      <div class="box">
        <h1>Sign in</h1>
        <p>If you already created a local account on this browser, sign in here.</p>

        <label for="siEmail">Email</label>
        <input id="siEmail" type="email" placeholder="you@example.com" autocomplete="email" />

        <label for="siPass">Password</label>
        <input id="siPass" type="password" placeholder="••••••••" autocomplete="current-password" />

        <div class="row">
          <button type="button" id="signInBtn">Sign in</button>
          <button type="button" class="secondary" id="resetBtn">Reset local demo</button>
        </div>

        <div class="warn" id="warn2"></div>

        <div class="meta">
          Demo note: real hosting later can publish to:
          <br />
          <strong>https://knottestudios.com/sites/&lt;your-slug&gt;/</strong>
        </div>
      </div>
    </div>
  </div>

  <script>
    function $(id){ return document.getElementById(id); }

    function getSelectedTemplate(){
      return localStorage.getItem("KS_SELECTED_TEMPLATE") || "";
    }
    function setSelectedTemplate(id){
      localStorage.setItem("KS_SELECTED_TEMPLATE", id);
    }

    function normalizeSlug(s){
      return String(s || "")
        .trim()
        .toLowerCase()
        .replaceAll(/[^a-z0-9]+/g, "-")
        .replaceAll(/^-+|-+$/g, "")
        .slice(0, 60) || "our-wedding";
    }

    function setWarn(el, msg){
      el.textContent = msg;
      el.style.display = msg ? "block" : "none";
    }

    function getAccounts(){
      try{ return JSON.parse(localStorage.getItem("KS_ACCOUNTS") || "[]"); }
      catch(e){ return []; }
    }
    function setAccounts(list){
      localStorage.setItem("KS_ACCOUNTS", JSON.stringify(list));
    }

    function setSession(email){
      localStorage.setItem("KS_SESSION_EMAIL", email);
    }
    function getSession(){
      return localStorage.getItem("KS_SESSION_EMAIL") || "";
    }

    function setUserProfile(email, profile){
      localStorage.setItem("KS_USER_" + email, JSON.stringify(profile));
    }
    function getUserProfile(email){
      try{ return JSON.parse(localStorage.getItem("KS_USER_" + email) || "null"); }
      catch(e){ return null; }
    }

    function refreshSelected(){
      const id = getSelectedTemplate();
      $("selectedTpl").textContent = id || "none";
    }

    $("pickTemplateBtn").addEventListener("click", () => {
      window.location.href = "9.KS.Home.html#templates";
    });

    $("signUpBtn").addEventListener("click", () => {
      const warn = $("warn1");
      setWarn(warn, "");

      const email = String($("suEmail").value || "").trim().toLowerCase();
      const pass = String($("suPass").value || "");
      const slug = normalizeSlug($("suSlug").value);
      const tpl = getSelectedTemplate();

      if(!tpl) return setWarn(warn, "Please choose a template first (go back to Home > Templates).");
      if(!email || !email.includes("@")) return setWarn(warn, "Enter a valid email.");
      if(pass.length < 6) return setWarn(warn, "Password must be at least 6 characters.");
      if(!slug) return setWarn(warn, "Enter a URL slug.");

      const accounts = getAccounts();
      if(accounts.some(a => a.email === email)){
        return setWarn(warn, "That email already exists in this demo. Use Sign in.");
      }
      if(accounts.some(a => a.slug === slug)){
        return setWarn(warn, "That URL slug is taken in this demo. Try another.");
      }

      accounts.push({ email, pass, slug });
      setAccounts(accounts);
      setSession(email);

      const defaultData = {
        templateId: tpl,
        slug,
        fields: {
          coupleNames: "Alex & Jamie",
          weddingDate: "October 10, 2026",
          weddingLocation: "Springfield, MO",
          welcomeMessage: "We’re so excited to celebrate with you. Scroll for details and RSVP below!",
          rsvpUrl: "https://example.com/rsvp",
          scheduleText: "4:00 PM Ceremony • 5:30 PM Cocktail Hour • 7:00 PM Reception",
          detailsText: "Dress code: semi-formal. Adults-only celebration. Please arrive 15 minutes early.",
          registryText: "We’re registered at: (add link). Your presence is the best gift.",
          storyText: "We met, we laughed, we built a life—now we’re getting married!"
        },
        updatedAt: Date.now()
      };

      setUserProfile(email, defaultData);
      window.location.href = "9.KS.Dashboard.html";
    });

    $("signInBtn").addEventListener("click", () => {
      const warn = $("warn2");
      setWarn(warn, "");

      const email = String($("siEmail").value || "").trim().toLowerCase();
      const pass = String($("siPass").value || "");

      const accounts = getAccounts();
      const found = accounts.find(a => a.email === email && a.pass === pass);

      if(!found) return setWarn(warn, "Invalid email or password (demo accounts are only on this browser).");

      setSession(email);

      // If they never selected a template, attempt to load from profile
      const prof = getUserProfile(email);
      if(prof && prof.templateId) setSelectedTemplate(prof.templateId);

      window.location.href = "9.KS.Dashboard.html";
    });

    $("resetBtn").addEventListener("click", () => {
      localStorage.removeItem("KS_ACCOUNTS");
      localStorage.removeItem("KS_SESSION_EMAIL");
      // Keep selected template optional:
      // localStorage.removeItem("KS_SELECTED_TEMPLATE");
      alert("Local demo reset (accounts cleared).");
    });

    refreshSelected();

    // If already signed in, push them to dashboard
    if(getSession()){
      window.location.href = "9.KS.Dashboard.html";
    }
  </script>
</body>
</html>
